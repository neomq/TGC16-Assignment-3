{{#extends 'base'}}

{{#block 'content'}}
<div class="py-3">
    <h2 class="display-6">Products</h2>
</div>

 <div class="d-flex">
    {{!-- Navigation --}}
    <div class="pe-3">
        <ul class="nav nav-pills flex-column">
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="/products">View Products</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Search Products</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/products/create">Add Products</a>
            </li>
            <li>
                <hr/>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/products/essential-oils">View Essential Oils</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/products/essential-oils/create">Add Essential Oils</a>
            </li>
        </ul>
    </div>
        
    {{!-- Form --}}
    <div class="w-75 ms-3">
        <div class="pb-3 border-bottom">
            <h4>Add New Product</h4>
        </div>
        <form method="POST">
            {{!-- Upload image --}}
            <div class="py-4">
                <div class="p-3 my-3 border">
                        <p class="fs-6 text-muted text-center fw-light">Click on "Upload Image" to upload a product image</p>
                        <div class="d-grid col-2 mx-auto">
                            <button type="button" class="btn btn-sm btn-primary" id="upload_widget">Upload Image</button>
                        </div>
                        <img src="" style="display:none" width="200" height="200" id="uploaded_image"/>
                </div>
            </div>
            {{{form}}}
            <input type="submit" value="Add Product" class="btn btn-primary mt-3"/>
        </form>
    </div>
 </div>

{{/block}}

{{/extends}}

{{#block 'js'}}
{{!-- Initialise Cloudinary --}}
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ==" crossorigin="anonymous"></script>
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

{{!-- Get signature --}}
<script>
    const cloudinaryName = '{{cloudinaryName}}';
    const cloudinaryApiKey = '{{cloudinaryApiKey}}';
    const cloudinaryPreset = '{{cloudinaryPreset}}';
    async function generateSignature(callback, params_to_sign) {
        let response = await axios.get('/cloudinary/sign',{
            'params':{
                params_to_sign
            }
        });
        // response.data contains the signature
        callback(response.data);
    }
    // create the cloudinary widget
    const config = {
        cloudName: cloudinaryName,
        apiKey: cloudinaryApiKey,
        uploadPreset: cloudinaryPreset,
        uploadSignature: generateSignature
    };
    const myWidget = cloudinary.createUploadWidget(config, (error, result) => {
        if (error) {
            console.log(error);
        };
        if (!error && result && result.event === 'success') {
            console.log(result);
            document.querySelector('#id_image').value = result.info.url;
            document.querySelector("#uploaded_image").src = result.info.url;
            document.querySelector("#uploaded_image").style.display = 'inline';
        }
    
    })
    document.querySelector("#upload_widget").addEventListener('click', function(){
        myWidget.open();
    })
</script>
{{/block}}